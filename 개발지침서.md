# 개발지침서
## 원가관리 웹 시스템 기술 명세

### 1. 기술 스택

#### 1.1 프론트엔드
- **React 18**: 컴포넌트 기반 UI 개발
- **TypeScript**: 타입 안정성 확보
- **Tailwind CSS**: 유틸리티 기반 스타일링
- **Recharts**: 차트/그래프 라이브러리
- **React Router**: SPA 라우팅
- **Zustand**: 상태 관리 (가벼운 Redux 대안)
- **React Dropzone**: 파일 업로드 UI 컴포넌트
- **XLSX**: Excel 파일 읽기/쓰기
- **Papa Parse**: CSV 파일 파싱

#### 1.2 백엔드
- **Node.js + Express**: RESTful API 서버
- **TypeScript**: 백엔드 타입 안정성
- **SQLite/PostgreSQL**: 관계형 데이터베이스
- **Prisma ORM**: 타입세이프 데이터베이스 ORM
- **CORS**: 크로스 오리진 리소스 공유
- **Multer**: 파일 업로드 미들웨어
- **XLSX**: Excel 파일 서버 사이드 처리
- **CSV Parser**: CSV 파일 파싱
- **Bull Queue**: 대용량 업로드 작업 큐

#### 1.3 개발 도구
- **Vite**: 빠른 개발 서버 및 빌드
- **ESLint + Prettier**: 코드 품질 관리
- **Husky**: Git Hook을 통한 자동 검사
- **Jest**: 단위 테스트 프레임워크

### 2. 프로젝트 구조

```
cost-management-system/
├── frontend/
│   ├── src/
│   │   ├── components/         # 재사용 컴포넌트
│   │   │   ├── common/        # 공통 컴포넌트
│   │   │   ├── dashboard/     # 대시보드 컴포넌트
│   │   │   ├── forms/         # 폼 컴포넌트
│   │   │   └── upload/        # 업로드 관련 컴포넌트
│   │   │       ├── FileUploader.tsx
│   │   │       ├── UploadPreview.tsx
│   │   │       ├── ProgressBar.tsx
│   │   │       └── UploadHistory.tsx
│   │   ├── pages/             # 페이지 컴포넌트
│   │   │   ├── Dashboard.tsx
│   │   │   ├── Procedures.tsx
│   │   │   ├── Materials.tsx
│   │   │   └── Upload.tsx     # 대량 업로드 페이지
│   │   ├── hooks/             # 커스텀 훅
│   │   │   ├── useFileUpload.ts
│   │   │   └── useUploadProgress.ts
│   │   ├── store/             # Zustand 상태 관리
│   │   ├── types/             # TypeScript 타입 정의
│   │   ├── utils/             # 유틸리티 함수
│   │   │   ├── fileValidation.ts
│   │   │   ├── excelParser.ts
│   │   │   └── csvParser.ts
│   │   └── services/          # API 호출 서비스
│   └── package.json
├── backend/
│   ├── src/
│   │   ├── controllers/       # 컨트롤러
│   │   │   └── uploadController.ts
│   │   ├── models/           # 데이터 모델
│   │   ├── routes/           # API 라우트
│   │   ├── services/         # 비즈니스 로직
│   │   │   ├── uploadService.ts
│   │   │   ├── validationService.ts
│   │   │   └── queueService.ts
│   │   ├── utils/            # 유틸리티
│   │   │   ├── fileProcessor.ts
│   │   │   ├── excelHandler.ts
│   │   │   └── csvHandler.ts
│   │   ├── jobs/            # 백그라운드 작업
│   │   │   └── uploadProcessor.ts
│   │   ├── uploads/         # 임시 업로드 폴더
│   │   └── prisma/          # Prisma 설정
│   └── package.json
└── README.md
```

### 3. API 설계

#### 3.1 RESTful API 엔드포인트

**시술 관리**
```
GET    /api/procedures       # 시술 목록 조회
GET    /api/procedures/:id   # 특정 시술 조회
POST   /api/procedures       # 시술 생성
PUT    /api/procedures/:id   # 시술 수정
DELETE /api/procedures/:id   # 시술 삭제
```

**재료 관리**
```
GET    /api/materials        # 재료 목록 조회
GET    /api/materials/:id    # 특정 재료 조회
POST   /api/materials        # 재료 생성
PUT    /api/materials/:id    # 재료 수정
DELETE /api/materials/:id    # 재료 삭제
```

**대량 업로드**
```
POST   /api/upload/materials         # 재료 대량 업로드
POST   /api/upload/procedures        # 시술 대량 업로드
POST   /api/upload/validate          # 업로드 전 데이터 검증
GET    /api/upload/template/:type    # 업로드 템플릿 다운로드
GET    /api/upload/history           # 업로드 이력 조회
POST   /api/upload/rollback/:id      # 업로드 롤백
GET    /api/upload/progress/:jobId   # 업로드 진행상황 확인
```

**데이터 내보내기**
```
GET    /api/export/materials         # 재료 데이터 Excel 다운로드
GET    /api/export/procedures        # 시술 데이터 Excel 다운로드
POST   /api/export/filtered          # 필터링된 데이터 다운로드
```

#### 3.2 데이터 모델

**Procedure (시술)**
```typescript
interface Procedure {
  id: number;
  name: string;
  category: string;
  customerPrice: number;
  materials: string;
  totalCost?: number;      // 계산된 총 원가
  margin?: number;         // 계산된 마진
  marginRate?: number;     // 계산된 마진율
  isRecommended?: boolean; // 추천 제품 여부
  createdAt: Date;
  updatedAt: Date;
}
```

**Material (재료)**
```typescript
interface Material {
  id: number;
  name: string;
  cost: number;
  createdAt: Date;
  updatedAt: Date;
}
```

### 4. 개발 가이드라인

#### 4.1 코딩 컨벤션
- **네이밍**: camelCase (변수/함수), PascalCase (컴포넌트/타입)
- **파일명**: PascalCase (컴포넌트), camelCase (유틸리티)
- **컴포넌트**: 함수형 컴포넌트 + React Hooks 사용
- **주석**: JSDoc 스타일로 작성

#### 4.2 성능 최적화
- React.memo() 적절한 사용으로 리렌더링 최소화
- useMemo, useCallback 활용한 연산 최적화
- 대용량 데이터는 가상화(Virtualization) 적용
- API 응답 데이터 캐싱

#### 4.3 에러 처리
- 전역 에러 바운더리 구현
- API 에러 상태별 적절한 메시지 표시
- 로딩 상태 관리 및 스켈레톤 UI
- 사용자 친화적 에러 메시지

### 5. 구현 우선순위

#### Week 1: 기본 인프라
- [ ] 프로젝트 세팅 및 개발 환경 구축
- [ ] 데이터베이스 스키마 설계 및 마이그레이션
- [ ] 기본 API 구조 및 모델 생성
- [ ] 프론트엔드 기본 구조 및 라우팅
- [ ] 파일 업로드 미들웨어 설정

#### Week 2: 핵심 기능 + 대량 업로드
- [ ] Excel 데이터 마이그레이션 스크립트
- [ ] 시술/재료 CRUD API 구현
- [ ] 원가/마진 자동 계산 로직
- [ ] **대량 업로드 API 구현 (파일 파싱, 검증)**
- [ ] **업로드 진행상황 추적 시스템**

#### Week 3: 업로드 UI + 대시보드
- [ ] **파일 업로드 UI 컴포넌트 구현**
- [ ] **데이터 검증 및 미리보기 화면**
- [ ] **업로드 진행률 표시 및 결과 보고**
- [ ] 대시보드 통계 API 구현
- [ ] 마진 순위 차트 구현

#### Week 4: 고급 기능 + 최적화
- [ ] **업로드 히스토리 및 롤백 기능**
- [ ] **데이터 내보내기 및 템플릿 다운로드**
- [ ] 검색/필터링 기능
- [ ] 성능 최적화 및 테스트
- [ ] 배포 및 운영 환경 구축

### 6. 테스트 전략
- **단위 테스트**: 비즈니스 로직 함수 100% 커버리지
- **통합 테스트**: API 엔드포인트 테스트
- **E2E 테스트**: 주요 사용자 플로우 테스트
- **성능 테스트**: 대용량 데이터 처리 성능 검증

### 7. 보안 고려사항
- SQL 인젝션 방지 (Prisma ORM 사용)
- XSS 공격 방지 (데이터 검증 및 이스케이프)
- HTTPS 적용
- API 요청 제한 (Rate Limiting)
- 사용자 인증/권한 관리 (선택사항)